import{_ as b}from"./index.vue_vue_type_script_setup_true_lang-3aef97d3.js";import{x as v,V as x,e as i,r as L,y as h,z as _,A as o,B as $,E as w,u as d,O as N,L as V,P as p,I as r,M as B,a7 as D}from"./runtime-core.esm-bundler-65d2a1d3.js";const E={class:"iz-upload"},I={key:0,class:"iz-upload-progress"},O={name:"IzUploadChunk"},R=v({...O,props:{url:{type:String,default:null},headers:{type:Object,default:()=>({})},size:{type:Number,default:5*1024*1024}},setup(f){const a=f,e=x({chunkFileCount:0,uploadSuccessFileCount:0,uploadUtil:0,chunkList:[],chunkUploadStatus:[]}),k=i(()=>e.chunkFileCount===0?"0%":(100*e.uploadSuccessFileCount/e.chunkFileCount).toFixed(2)+"%"),u=i(()=>e.chunkFileCount===e.uploadSuccessFileCount?"done":"uploading"),S=i(()=>u.value==="uploading"?"visibility: hidden":""),c=L(),F=()=>{var t;(t=c.value)==null||t.click()},m=(t,n)=>{const s=new FormData;s.append("file",t),fetch(a.url,{method:"post",headers:a.headers,body:s}).then(()=>{e.uploadSuccessFileCount++,e.chunkUploadStatus[n]=!0}).finally(()=>{e.uploadUtil+1<e.chunkList.length&&m(e.chunkList[++e.uploadUtil],e.uploadUtil)})},U=()=>{e.chunkFileCount=1,e.uploadSuccessFileCount=0},z=()=>{var y,C;U();const t=(C=(y=c.value)==null?void 0:y.files)==null?void 0:C[0],n=a.size,s=[],g=[];for(let l=0;l*n<t.size;)s.push(t.slice(l*n,++l*n)),g.push(!1);e.chunkList=s,e.chunkUploadStatus=g,e.chunkFileCount=s.length,e.uploadUtil=s.length>=30?29:s.length-1;for(let l=0;l<e.uploadUtil+1;l++)m(e.chunkList[l],l)};return(t,n)=>(h(),_("div",E,[o("div",{style:w(d(S)),class:"iz-upload-trigger",onClick:F},[$(t.$slots,"default")],4),d(u)==="uploading"?(h(),_("div",I,N(d(k)),1)):V("",!0),o("input",{ref_key:"uploadRef",ref:c,multiple:!1,type:"file",style:{display:"none"},onChange:z},null,544)]))}});const j={class:"page-md-editor"},A=o("div",{class:"page-header"},[o("div",{class:"left"},[o("h2",null,"分片上传"),o("p",null,"演示分片上传功能，只支持本地运行，服务端在mock中实现。")])],-1),M={class:"view-space"},P="UploadSlice",T={name:P},H=v({...T,setup(f){const a="https://www.fastmock.site/mock/666b2bc3ee91f13644d96f70db736879/api//upload/chunk";return(e,k)=>{const u=D("el-button");return h(),_("div",j,[A,o("div",M,[p(b,null,{default:r(()=>[p(R,{url:a},{default:r(()=>[p(u,null,{default:r(()=>[B("上传")]),_:1})]),_:1})]),_:1})])])}}});export{H as default};
